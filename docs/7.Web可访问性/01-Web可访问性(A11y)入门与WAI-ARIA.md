# 19-Web 可访问性 (A11y) 入门与 WAI-ARIA

Web 可访问性（Accessibility，常缩写为 a11y）是指**确保 Web 内容和应用能够被尽可能多的人群所访问和使用，无论他们的身体能力、网络环境或使用的设备如何**。这尤其包括了有视觉、听觉、运动或认知障碍的人士。

构建可访问的应用，不仅是优秀工程实践的体现，更是开发者社会责任感的一部分，在许多国家和地区，它也是一项法律要求。

## 1. 为什么 A11y 很重要？

*   **扩大用户群体**：让残障人士也能成为你的用户。
*   **提升用户体验**：为一个群体所做的优化，通常能让所有用户受益。例如，高对比度的设计对视力障碍用户至关重要，但也能让正常用户在阳光下看得更清楚。
*   **SEO 优化**：许多 a11y 的最佳实践（如语义化 HTML、`alt` 文本）与搜索引擎优化的原则不谋而合。
*   **法律与合规要求**：在许多国家，为公共服务和商业网站提供可访问性是强制性的法律规定。

## 2. WCAG: 可访问性内容的 Web 标准

**WCAG (Web Content Accessibility Guidelines)** 是由 W3C 发布的、国际公认的 Web 可访问性指南。它提出了一系列可以被测试的成功标准，并围绕四个核心原则进行组织 (POUR)：

1.  **可感知 (Perceivable)**：信息和用户界面组件必须以用户可以感知的方式呈现。
    *   *示例*：为图片提供 `alt` 替代文本，为视频提供字幕。
2.  **可操作 (Operable)**：用户界面组件和导航必须是可操作的。
    *   *示例*：所有功能都必须能通过键盘来访问，避免“键盘陷阱”。
3.  **可理解 (Understandable)**：信息和用户界面的操作必须是可理解的。
    *   *示例*：网站的语言应清晰一致，导航应可预测。
4.  **健壮 (Robust)**：内容必须足够健壮，能够被包括辅助技术在内的各种用户代理可靠地解析。
    *   *示例*：使用符合标准的 HTML，确保自定义组件能被屏幕阅读器等工具正确识别。

WCAG 定义了三个一致性级别：A (最低), AA (中等), AAA (最高)。**AA 级**是目前 Web 开发中被广泛接受的行业标准。

## 3. WAI-ARIA: 弥补语义的桥梁

虽然语义化的 HTML 是实现可访问性的基石，但随着 Web 应用变得越来越复杂，我们经常会用 `<div>` 和 `<span>` 来构建各种自定义组件（如菜单、滑块、选项卡）。这些非语义化的元素，对于辅助技术（如屏幕阅读器）来说是**没有意义**的。

**WAI-ARIA (Web Accessibility Initiative – Accessible Rich Internet Applications)**，简称 ARIA，就是为了解决这个问题而诞生的。它是一套可以添加到 HTML 元素上的**属性**，用于**向辅助技术补充**原本缺失的**语义信息**。

ARIA 不会改变元素的外观或行为，它只改变元素在“可访问性树 (Accessibility Tree)”中的含义。

> **深入理解：可访问性树 (Accessibility Tree)**
> 
> 浏览器在解析 DOM 树的同时，会并行生成一棵简化的、专门供辅助技术（如屏幕阅读器）使用的树状结构，这就是“可访问性树”。
> *   **与 DOM 树的关系**：它是 DOM 树的一个子集和变体，只包含对辅助技术有语义价值的节点（如按钮、链接、表单元素等），而纯粹的装饰性元素（如 `<div>`）通常会被忽略。
> *   **ARIA 的作用**：ARIA 属性（`role`, `aria-*`）的核心作用就是**直接修改和丰富这棵可访问性树**，而不会影响 DOM 的结构或样式。
> *   **开发者工具**：在 Chrome 等浏览器的开发者工具中，选中一个元素，然后在 **Elements** 面板右侧的窗格中选择 **Accessibility** 标签页，就可以直观地看到该元素在可访问性树中的节点信息。这是调试 A11y 问题最有力的工具。

### a. ARIA 的核心：角色 (Roles) 和 属性 (Properties/States)

1.  **角色 (Role)**
    *   **作用**：定义一个元素是“什么”。它告诉辅助技术这个组件的类型。
    *   **示例**：
        ```html
        <!-- 告诉屏幕阅读器，这个 div 是一个导航区域 -->
        <div role="navigation">...</div>

        <!-- 告诉屏幕阅读器，这个 div 是一个选项卡列表 -->
        <div role="tablist">
          <div role="tab" aria-selected="true">Tab 1</div>
          <div role="tab"aria-selected="false">Tab 2</div>
        </div>
        ```
    *   **第一原则**：**如果能用原生的 HTML 元素，就不要使用 ARIA 角色**。例如，`<nav>` 标签天生就带有 `navigation` 的角色，`<button>` 标签也比 `<div role="button">` 更好。

2.  **属性 (Property)**
    *   **作用**：描述元素的特征或关系。
    *   **示例**：
        *   `aria-label`: 为元素提供一个在视觉上不可见，但能被屏幕阅读器读出的标签。
          ```html
          <button aria-label="关闭">&times;</button>
          ```
        *   `aria-labelledby`: 将一个元素的标签与页面上的另一个元素关联起来。
        *   `aria-describedby`: 为元素提供更详细的描述信息。
        *   `aria-hidden="true"`: 将元素从可访问性树中完全隐藏。
        *   `aria-required="true"`: 表明一个表单输入是必填的。

3.  **状态 (State)**
    *   **作用**：描述元素当前所处的状态，这些状态通常会随着用户交互而改变。
    *   **示例**：
        *   `aria-selected="true/false"`: 表明一个选项卡或选项是否被选中。
        *   `aria-expanded="true/false"`: 表明一个可折叠的区域（如手风琴面板）是展开还是折叠状态。
        *   `aria-checked="true/false/mixed"`: 表明一个复选框或单选按钮的选中状态。
        *   `aria-disabled="true/false"`: 表明一个元素当前是否被禁用。

### b. 使用 ARIA 的黄金法则

1.  **优先使用原生 HTML**：原生 `<button>`, `<input>`, `<nav>` 等元素自带了丰富的键盘交互和可访问性语义，是最好的选择。
2.  **不要改变原生语义**：除非迫不得已，不要用 ARIA 改变原生元素的角色，例如 `<h1 role="button">`。
3.  **所有交互元素必须能通过键盘访问**：如果使用 `div` 配合 `role="button"`，你必须手动为其添加 `tabindex="0"` 并处理 `Enter` 和 `Space` 键的 `keydown` 事件。
4.  **不要隐藏焦点**：如果一个元素是可交互的，它的焦点状态 `(:focus)` 必须是视觉上可见的。
5.  **为交互元素提供可访问的名称**：所有按钮、链接、表单控件都必须有明确的文本标签。如果视觉上没有，就必须通过 `aria-label` 等方式提供。
6.  **主动管理动态内容中的焦点**：当 UI 发生显著变化时（如打开模态框、显示一个面板），必须使用 JavaScript (`element.focus()`) 将键盘焦点主动移动到新的内容区域中。否则，依赖键盘的用户可能会“迷失”在旧的上下文中，无法与新内容进行交互。

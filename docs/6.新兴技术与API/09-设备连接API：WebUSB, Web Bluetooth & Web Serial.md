# 09-设备连接API：WebUSB, Web Bluetooth & Web Serial

至此，我们已经探索了浏览器在计算、存储、网络和系统集成等多个维度的前沿能力。然而，Web 平台的终极目标是成为一个真正的通用应用平台，这意味着它还需要突破数字世界的边界，与我们身边的**物理世界**直接交互。这正是设备连接 API 族群所要完成的使命。

这些 API 允许 Web 应用在用户授权后，安全地发现、连接并与连接到计算机的硬件设备进行通信，为 Web of Things (WoT) 和硬件交互应用打开了想象空间。

## 1. WebUSB API

*   **能力**：允许 Web 应用与 USB 设备进行通信。
*   **应用场景**：
    *   **硬件钱包**：直接在网页上与 Ledger, Trezor 等硬件钱包交互以签署交易。
    *   **固件更新**：为微控制器（如 Arduino, ESP32）或硬件设备（如3D打印机）直接从网页刷入新固件。
    *   **教育与开发**：在 Web IDE 中直接与 USB 连接的开发板进行编程和调试。
*   **工作流程**：
    1.  `navigator.usb.requestDevice()`：提示用户从一个列表中选择一个已连接的 USB 设备进行授权。
    2.  与设备建立连接，选择配置，声明接口。
    3.  通过 `transferIn()` (读取) 和 `transferOut()` (写入) 与设备的端点进行数据交换。

## 2. Web Bluetooth API

*   **能力**：允许 Web 应用通过蓝牙低功耗 (Bluetooth Low Energy, BLE) 协议与附近的设备进行通信。
*   **应用场景**：
    *   **健康与运动**：连接心率监测器、智能手环、血糖仪等设备，并实时读取数据。
    *   **智能家居**：控制智能灯泡、插座、温控器等 BLE 设备。
    *   **设备配置**：为各种物联网设备提供一个无需安装 App 的网页配置界面。
*   **工作流程**：
    1.  `navigator.bluetooth.requestDevice()`：扫描附近的 BLE 设备，并让用户选择一个进行配对。
    2.  连接到设备的 GATT (Generic Attribute Profile) 服务器。
    3.  获取服务 (`Service`) 和特征 (`Characteristic`)。
    4.  通过 `readValue()` 和 `writeValue()` 对特征进行读写操作，或通过 `startNotifications()` 订阅数据更新。

## 3. Web Serial API

*   **能力**：允许 Web 应用通过串行端口进行读写。这是许多工业设备、微控制器和遗留硬件的标准通信方式。
*   **应用场景**：
    *   **物联网 (IoT)**：与各种使用串口通信的传感器和执行器进行交互。
    *   **工业控制**：连接和控制工业设备、CNC机床、3D打印机等。
    *   **遗留设备支持**：为那些依赖串口的老旧硬件提供现代化的 Web 交互界面。
*   **工作流程**：
    1.  `navigator.serial.requestPort()`：提示用户选择一个可用的串口进行授权。
    2.  打开端口 (`port.open()`)，并指定波特率等参数。
    3.  通过 `port.readable` (ReadableStream) 和 `port.writable` (WritableStream) 进行数据的双向流式传输。

## 安全与用户体验

这些 API 的设计都将**安全**放在了最高优先级。**没有任何网站可以在用户不知情或许可的情况下访问任何设备**。所有的连接都必须由用户通过一个明确的、由浏览器控制的UI（如设备选择列表）来发起和授权。

## 总结：Web 的终极边界

设备连接 API 族群是 Web 平台迈向“无所不能”的终极一步。它们彻底打破了软件与硬件、虚拟与现实之间的壁垒，将 Web 应用的能力从屏幕之内延伸到了我们触手可及的物理世界。这不仅为 Web 开发者开辟了物联网、智能硬件等全新的赛道，也标志着浏览器作为通用应用平台的理念已然成熟。这，就是 Web 的终极边界，也是 Web 的无限未来。
